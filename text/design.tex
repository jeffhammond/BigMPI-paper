% !TEX root = ../bigmpi.tex

\section{Design}

The API follows the pattern of \texttt{MPI\_Type\_size(\_x)} in that all BigMPI
functions are identical to their corresponding MPI ones except that
they end with \texttt{\_x} to indicate that the count arguments have the type
\texttt{MPI\_Count} instead of \texttt{int}.
BigMPI functions use the MPIX namespace because they are not in the
MPI standard.


\texttt{MPIX\_Type\_contiguous\_x}
does the heavy lifting.  It's pretty obvious how it works.
The datatypes engine will turn this into a contiguous datatype internally 
and thus the underlying communication will be efficient.  
MPI implementations need to be count-safe for this to work, but they need
to be count-safe period if the Forum is serious about datatypes being
the solution rather than \texttt{MPI\_Count} everywhere.

All of the communication functions follow the same pattern, which is
clearly seen in PASTE CODE
%in [MPIX_Send_x](https://github.com/jeffhammond/BigMPI/blob/master/src/sendrecv_x.c).
I've optimized for the common case when count is smaller than $2^{31}$ 
with a \texttt{likely\_if} macro to minimize the performance hit of BigMPI
for this more common use case
(hopefully so that users don't insert a branch for this themselves)

The most obvious optimization I can see doing is to implement
\texttt{MPIX\_Type\_contiguous\_x} using internals of the MPI implementation 
instead of calling six MPI datatype functions.

\subsection{Limitations}

Even though \texttt{MPI\_Count} might be 128b, BigMPI only supports
64b counts (because of \texttt{MPI\_Aint} limitations and a desire to use \texttt{size\_t}
in unit tests), so BigMPI is not going to solve your problem if you
want to communicate more than 8 EiB of data in a single message.
Such computers do not exist nor is it likely that they will exist
in the foreseeable future.

BigMPI only supports built-in datatypes.  If you are already using
derived-datatypes, then you should already be able to handle large
counts without BigMPI.

Support for \texttt{MPI\_IN\_PLACE} is not implemented in some cases and
implemented inefficiently in others.
Using \texttt{MPI\_IN\_PLACE} is discouraged at the present time.
We hope to support it more effectively in the future.

BigMPI requires C99.  If your compiler does not support C99, get a
new compiler.

BigMPI only has C bindings right now.
Fortran 2003 bindings are planned.
If C++ bindings are important to you, please create an issue for this.